<mat-sidenav-container class="dkim">
    <mat-sidenav mode="side" opened=false></mat-sidenav>
    <mat-sidenav-content>
            <section class="mat-typography">
                <mat-card class='dkim'>
                    <mat-card-header style="display: flex; width: 100%">
                        <mat-card-title style="flex-grow: 1">
                            <h1 class="mat-h1">DKIM <h2>{{domain}}</h2></h1>
                            This is the DKIM configuration for domain {{domain}}.
                            There are 2 selectors with difrent private & public keys that are required for proper key rotation. Only 1 selector is active.
                            The first time key is enabled, it can take up to 48hrs to propagate in dns world wide.

                        </mat-card-title>
                    </mat-card-header>
                    <mat-divider></mat-divider>
                    <mat-accordion *ngIf="keys.length">
                      <mat-expansion-panel *ngFor="let item of keys">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                {{item.selector_recordset_name}}
                            </mat-panel-title>
                          <mat-panel-description>
                            updated at {{item.updated}}
                            <span>{{get_status(item)}}</span>
                          </mat-panel-description>
                        </mat-expansion-panel-header>

                        <div *ngIf="item.is_active && item.date_saved_to_pdns && item.date_rotation_finalized">
                            <p>
                                This key was published on {{item.date_saved_to_pdns}} and is active since {{item.date_rotation_finalized}}.
                                <br>
                                Make sure to update dns settings:
                                <br>
                                Go to dns &gt; {{domain}} &gt; add CNAME &gt;
                                <br> name: <strong>{{item.selector_recordset_name}}</strong>
                                <br> value: <strong>{{item.public_recordset_name}}</strong>
                                <br> ttl: &gt; 3600
                                <br>To verify use: 
                                <br>
                                <mat-checkbox *ngIf="item.is_cname_hosted_by_runbox && item.is_cname_correct" [disabled]="disabled" [(ngModel)]="item.is_cname_correct">Cname correct</mat-checkbox>
                                <br>
                                <button  mat-raised-button color="primary" *ngIf="item.is_cname_hosted_by_runbox" (click)="reconfigure(item)">Reconfigure</button>
                            </p>
                            <pre>
                                dig -t cname {{item.selector_recordset_name}} +short

                                It should point to {{item.public_recordset_name}}
                            </pre>
                            <br>
                                Your public key can be retrieved with
                            <pre>
                                dig -t txt {{item.public_recordset_name}}
                            </pre>
                        </div>
                        <p *ngIf="!is_rotating && !item.is_active && !item.date_saved_to_pdns && !item.date_rotation_finalized">
                            This key was published for the first time on {{item.created}}. It takes 7 days to be effectively published.
                        </p>
                        <p *ngIf="!item.is_active && item.date_deactivated">
                            Deactivated on: {{item.date_deactivated}}
                        </p>
                        <p *ngIf="is_rotating && !item.active">
                            This key is under rotation state. This means it has been published however this key is not in use yet. Rotation has initialized on {{item.date_rotation_initiated}} and is expected to take 7 days to become active.
                        </p>
                      </mat-expansion-panel>

                    </mat-accordion>
                    <div *ngIf="!keys.length">
                        No keys found for {{domain}}
                        <button mat-raised-button color="primary" (click)="create_keys()">Create keys for {{domain}}</button>
                    </div>
                </mat-card>
            </section>
    </mat-sidenav-content>
</mat-sidenav-container>

